# 文件管理功能说明

## 概述
本项目新增了文件管理功能，使用Constants.java中配置的数据库账号密码连接本地数据库，提供完整的文件CRUD操作。

## 数据库配置
- 数据库用户名: `root` (来自Constants.DB_NAME)
- 数据库密码: `dcaudfjw@2025` (来自Constants.DB_PASS)
- 数据库URL: `jdbc:mysql://localhost:3306/db_news_system`

## 功能特性

### 1. 文件实体类 (File.java)
- 文件ID、文件名、文件路径、文件URL
- 文件类型、文件大小
- 创建时间、更新时间

### 2. 数据库操作 (FileDao.java)
- 查询所有文件列表
- 按文件类型查询
- 按文件名模糊查询
- 添加文件记录
- 删除文件记录

### 3. 业务逻辑层 (FileService.java)
- 封装业务逻辑
- 异常处理
- 数据验证

### 4. 控制器层 (FileController.java)
- RESTful API设计
- 统一的返回格式
- 完整的CRUD操作

## API接口

### 获取配置信息
```
GET /api/file/config
```
返回数据库配置信息

### 获取文件列表
```
GET /api/file/list
```
返回所有文件列表

### 按类型查询文件
```
GET /api/file/list/type/{fileType}
```
根据文件类型查询文件列表

### 按名称查询文件
```
GET /api/file/list/name?fileName={fileName}
```
根据文件名模糊查询

### 添加文件
```
POST /api/file/add
Content-Type: application/json

{
    "fileName": "文件名",
    "filePath": "文件路径",
    "fileUrl": "文件URL",
    "fileType": "文件类型",
    "fileSize": 文件大小
}
```

### 删除文件
```
DELETE /api/file/delete/{fileId}
```
根据文件ID删除文件记录

## 数据库表结构

### tb_file表
```sql
CREATE TABLE `tb_file` (
  `file_id` bigint(20) NOT NULL AUTO_INCREMENT COMMENT '文件主键id',
  `file_name` varchar(200) NOT NULL DEFAULT '' COMMENT '文件名',
  `file_path` varchar(500) NOT NULL DEFAULT '' COMMENT '文件路径',
  `file_url` varchar(500) NOT NULL DEFAULT '' COMMENT '文件访问URL',
  `file_type` varchar(50) NOT NULL DEFAULT '' COMMENT '文件类型',
  `file_size` bigint(20) NOT NULL DEFAULT '0' COMMENT '文件大小(字节)',
  `create_time` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  `update_time` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '修改时间',
  PRIMARY KEY (`file_id`),
  KEY `idx_file_type` (`file_type`),
  KEY `idx_create_time` (`create_time`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 COMMENT='文件信息表';
```

## 使用步骤

### 1. 创建数据库表
执行 `tb_file_schema.sql` 文件中的SQL语句来创建文件表：

```sql
-- 在MySQL中执行
USE db_news_system;
SOURCE tb_file_schema.sql;
```

### 2. 启动应用
确保MySQL服务运行，然后启动Spring Boot应用：

```bash
mvn spring-boot:run
```

### 3. 测试API
访问测试页面：`http://localhost:8080/file-test.html`

或者使用API工具（如Postman）测试各个接口。

## 测试数据
系统会自动插入一些测试数据：
- 图片文件 (JPG, PNG)
- 文档文件 (PDF)
- 视频文件 (MP4)
- 音频文件 (MP3)

## 返回格式
所有API都返回统一的JSON格式：

```json
{
    "success": true/false,
    "message": "操作结果描述",
    "data": "数据内容",
    "total": "数据总数"
}
```

## 注意事项
1. 确保MySQL服务正在运行
2. 确保数据库连接配置正确
3. 文件路径和URL需要根据实际情况调整
4. 建议在生产环境中添加适当的权限控制

## 扩展功能
可以根据需要扩展以下功能：
- 文件上传功能
- 文件下载功能
- 文件预览功能
- 文件分类管理
- 文件权限控制 